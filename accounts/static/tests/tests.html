<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Javascript Tests</title>
  <link rel="stylesheet" href="../../../superlists/static/tests/qunit.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture">
    <a id="id_login">Sign in</a>
  </div>

  <script src="http://code.jquery.com/jquery.min.js"></script>
  <script src="../../../superlists/static/tests/qunit.js"></script>
  <script src="../../../superlists/static/tests/sinon.js"></script>
  <script src="../js/accounts.js"></script>
  <script>
/*global $, test, equal, sinon, Superlists */

test("initialize binds sign in button to navigator.id.request", function () {
    var requestWasCalled = false;
    var mockRequestFunction = function () { requestWasCalled = true; };
    var mockNavigator = {
        id: {
            request: mockRequestFunction,
            watch: function() {}
        }
    };

    Superlists.Accounts.initialize(mockNavigator);

    $('#id_login').trigger('click');

    equal(requestWasCalled, true);
});

test("initialize calls navigator.id.watch", function() {
  var user = 'current user';
  var token = 'csrf token';
  var urls = {login: 'login url', logout: 'logout url'};
  var mockNavigator = {
    id: {
      watch: sinon.mock()
    }
  };

  Superlists.Accounts.initialize(mockNavigator, user, token, urls);

  equal(
    mockNavigator.id.watch.calledOnce,
    true,
    'check watch function called'
  );
});

test("watch sees current user", function() {
 var user = 'current user';
 var token = 'csrf token';
 var urls = {
  'login': 'login url',
  'logout': 'logout url'
  };
  var mockNavigator = {
    id: { watch: sinon.mock() }
  }


}
  </script>

</body>
</html>
